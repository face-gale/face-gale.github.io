(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{585:function(t,e,a){"use strict";a.r(e);var s=a(42),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-安装前的准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-安装前的准备"}},[t._v("#")]),t._v(" Kubernetes 安装前的准备")]),t._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("本次安装采用 Ubuntu Server X64 18.04 LTS 版本安装 kubernetes 集群环境，集群节点为 1 主 2 从模式，此次对虚拟机会有些基本要求，如下：")]),t._v(" "),a("ul",[a("li",[t._v("OS：Ubuntu Server X64 18.04 LTS（16.04 版本步骤相同，再之前则不同）")]),t._v(" "),a("li",[t._v("CPU：最低要求，1 CPU 2 核")]),t._v(" "),a("li",[t._v("内存：最低要求，2 GB")]),t._v(" "),a("li",[t._v("磁盘：最低要求，20 GB")])]),t._v(" "),a("h2",{attrs:{id:"节点配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点配置"}},[t._v("#")]),t._v(" 节点配置")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("主机名")]),t._v(" "),a("th",[t._v("IP")]),t._v(" "),a("th",[t._v("角色")]),t._v(" "),a("th",[t._v("系统")]),t._v(" "),a("th",[t._v("CPU/内存")]),t._v(" "),a("th",[t._v("磁盘")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("kubernetes-master")]),t._v(" "),a("td",[t._v("192.168.27.110")]),t._v(" "),a("td",[t._v("Master")]),t._v(" "),a("td",[t._v("Ubuntu Server 18.04")]),t._v(" "),a("td",[t._v("2 核 2G")]),t._v(" "),a("td",[t._v("20G")])]),t._v(" "),a("tr",[a("td",[t._v("kubernetes-node-01")]),t._v(" "),a("td",[t._v("192.168.27.120")]),t._v(" "),a("td",[t._v("Node")]),t._v(" "),a("td",[t._v("Ubuntu Server 18.04")]),t._v(" "),a("td",[t._v("2 核 4G")]),t._v(" "),a("td",[t._v("20G")])]),t._v(" "),a("tr",[a("td",[t._v("kubernetes-node-02")]),t._v(" "),a("td",[t._v("192.168.27.121")]),t._v(" "),a("td",[t._v("Node")]),t._v(" "),a("td",[t._v("Ubuntu Server 18.04")]),t._v(" "),a("td",[t._v("2 核 4G")]),t._v(" "),a("td",[t._v("20G")])])])]),t._v(" "),a("h2",{attrs:{id:"统一环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#统一环境配置"}},[t._v("#")]),t._v(" 统一环境配置")]),t._v(" "),a("blockquote",[a("p",[t._v("注意： 以下步骤请在制作 VMware 镜像时一并完成，避免逐台安装的痛苦")])]),t._v(" "),a("h3",{attrs:{id:"关闭交换空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭交换空间"}},[t._v("#")]),t._v(" 关闭交换空间")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("swapoff -a\n")])])]),a("p",[t._v("输入以下命令可以查看是否关闭成功。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("free -h\n# 输出\n            total        used        free      shared  buff/cache   available\nMem:           1.9G        276M        1.0G        1.2M        689M        1.5G\nSwap:            0B          0B          0B\n")])])]),a("h3",{attrs:{id:"避免开机启动交换空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免开机启动交换空间"}},[t._v("#")]),t._v(" 避免开机启动交换空间")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 注释 swap 开头的行\nvi /etc/fstab\n")])])]),a("h3",{attrs:{id:"关闭防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[t._v("#")]),t._v(" 关闭防火墙")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ufw disable\n")])])]),a("h3",{attrs:{id:"配置-dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-dns"}},[t._v("#")]),t._v(" 配置 DNS")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 取消 DNS 行注释，并增加 DNS 配置如：114.114.114.114，修改后重启下计算机\nvi /etc/systemd/resolved.conf\n")])])]),a("h3",{attrs:{id:"安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker"}},[t._v("#")]),t._v(" 安装 Docker")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# 更新软件源\nsudo apt-get update\n# 安装所需依赖\nsudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common\n# 安装 GPG 证书\ncurl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n# 新增软件源信息\nsudo add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"\n# 再次更新软件源\nsudo apt-get -y update\n# 安装 Docker CE 版\nsudo apt-get -y install docker-ce\n')])])]),a("h3",{attrs:{id:"配置-docker-加速器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker-加速器"}},[t._v("#")]),t._v(" 配置 Docker 加速器")]),t._v(" "),a("blockquote",[a("p",[t._v("注意： 国内镜像加速器可能会很卡，请替换成你自己阿里云镜像加速器")])]),t._v(" "),a("p",[t._v("在 /etc/docker/daemon.json 中写入如下内容（以下配置修改 cgroup 驱动为 systemd，满足 K8S 建议）")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "registry-mirrors": [\n    "https://o53x0kmt.mirror.aliyuncs.com"\n  ]\n}\n')])])]),a("p",[t._v("重启docker,并输入"),a("code",[t._v("docker info")]),t._v("命令查看是否设置成功。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemctl restart docker\n")])])]),a("h3",{attrs:{id:"安装-kubernetes-必备工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubernetes-必备工具"}},[t._v("#")]),t._v(" 安装 Kubernetes 必备工具")]),t._v(" "),a("p",[t._v("安装三个 Kubernetes 必备工具，分别为 kubeadm，kubelet，kubectl")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 安装系统工具\napt-get update && apt-get install -y apt-transport-https\n# 安装 GPG 证书\ncurl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -\n# 写入软件源；注意：我们用系统代号为 bionic，但目前阿里云不支持，所以沿用 16.04 的 xenial\ncat << EOF >/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n# 安装\napt-get update && apt-get install -y kubelet kubeadm kubectl\n")])])]),a("h3",{attrs:{id:"同步时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步时间"}},[t._v("#")]),t._v(" 同步时间")]),t._v(" "),a("ul",[a("li",[t._v("设置时区")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("dpkg-reconfigure tzdata\n")])])]),a("ul",[a("li",[a("p",[t._v("选择 Asia（亚洲）\n")]),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"http://ww1.sinaimg.cn/large/007Rnr4nly1g8m2dhvzq1j31fu0gjq38.jpg"}})]),a("p")]),t._v(" "),a("li",[a("p",[t._v("选择 Shanghai（上海）")])])]),t._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"http://ww1.sinaimg.cn/large/007Rnr4nly1g8m2e2bghtj30nn0o0aaj.jpg"}})]),t._v(" "),a("ul",[a("li",[t._v("时间同步")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 安装 ntpdate\napt-get install ntpdate\n# 设置系统时间与网络时间同步（cn.pool.ntp.org 位于中国的公共 NTP 服务器）\nntpdate cn.pool.ntp.org\n# 将系统时间写入硬件时间\nhwclock --systohc\n")])])]),a("ul",[a("li",[t._v("确认时间")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("date\n# 输出如下（自行对照与系统时间是否一致）\nMon Nov  4 21:04:46 CST 2019\n")])])]),a("h3",{attrs:{id:"修改-cloud-cfg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-cloud-cfg"}},[t._v("#")]),t._v(" 修改 cloud.cfg")]),t._v(" "),a("p",[t._v("主要作用是防止重启后主机名还原")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi /etc/cloud/cloud.cfg\n# 该配置默认为 false，修改为 true 即可\npreserve_hostname: true\n")])])]),a("h2",{attrs:{id:"单独节点配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单独节点配置"}},[t._v("#")]),t._v(" 单独节点配置")]),t._v(" "),a("blockquote",[a("p",[t._v("注意： 为 Master 和 Node 节点单独配置对应的 IP 和 主机名")])]),t._v(" "),a("h3",{attrs:{id:"配置-ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-ip"}},[t._v("#")]),t._v(" 配置 IP")]),t._v(" "),a("p",[t._v("编辑 vi /etc/netplan/50-cloud-init.yaml 配置文件，再输入时设置"),a("code",[t._v(":set paste")]),t._v("能确保格式正确。修改内容如下")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("network:\n    ethernets:\n        ens33:\n          addresses: [192.168.27.110/24]\n          gateway4: 192.168.27.2\n          nameservers:\n            addresses: [192.168.27.2]\n    version: 2\n")])])]),a("p",[t._v("使用 netplan apply 命令让配置生效")]),t._v(" "),a("h3",{attrs:{id:"配置主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置主机名"}},[t._v("#")]),t._v(" 配置主机名")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 修改主机名\nhostnamectl set-hostname kubernetes-master\n# 配置 hosts\ncat >> /etc/hosts << EOF\n192.168.27.110 kubernetes-master\nEOF\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 修改主机名\nhostnamectl set-hostname kubernetes-node-01\n# 配置 hosts\ncat >> /etc/hosts << EOF\n192.168.27.120 kubernetes-node-01\nEOF\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 修改主机名\nhostnamectl set-hostname kubernetes-node-02\n# 配置 hosts\ncat >> /etc/hosts << EOF\n192.168.27.121 kubernetes-node-02\nEOF\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);
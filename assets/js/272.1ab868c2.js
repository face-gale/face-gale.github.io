(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{617:function(t,e,n){"use strict";n.r(e);var s=n(42),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"rocketmq-基于-docker-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-基于-docker-安装"}},[t._v("#")]),t._v(" RocketMQ-基于 Docker 安装")]),t._v(" "),n("h2",{attrs:{id:"docker-compose-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[t._v("#")]),t._v(" docker-compose.yml")]),t._v(" "),n("p",[n("strong",[t._v("注意：启动 RocketMQ Server + Broker + Console 至少需要 2G 内存")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.5'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmqnamesrv")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foxiswho/rocketmq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("server\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rmqnamesrv\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 9876"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/logs\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/store\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rmqnamesrv\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmqbroker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foxiswho/rocketmq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("broker\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rmqbroker\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 10909"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10909")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 10911"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10911")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/logs\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/store\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data/brokerconf/broker.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/rocketmq/broker.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NAMESRV_ADDR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rmqnamesrv:9876"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("JAVA_OPTS")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('" -Duser.home=/opt"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("JAVA_OPT_EXT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-server -Xms128m -Xmx128m -Xmn128m"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mqbroker "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c /etc/rocketmq/broker.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rmqnamesrv\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rmqbroker\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmqconsole")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" styletang/rocketmq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ng\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rmqconsole\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("JAVA_OPTS")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rmqnamesrv\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rmqconsole\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rmq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rmq\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n")])])]),n("h2",{attrs:{id:"broker-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#broker-conf"}},[t._v("#")]),t._v(" broker.conf")]),t._v(" "),n("p",[t._v("RocketMQ Broker 需要一个配置文件，按照上面的 Compose 配置，我们需要在 "),n("code",[t._v("./data/brokerconf/")]),t._v(" 目录下创建一个名为 "),n("code",[t._v("broker.conf")]),t._v(" 的配置文件，内容如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('# Licensed to the Apache Software Foundation (ASF) under one or more\n# contributor license agreements.  See the NOTICE file distributed with\n# this work for additional information regarding copyright ownership.\n# The ASF licenses this file to You under the Apache License, Version 2.0\n# (the "License"); you may not use this file except in compliance with\n# the License.  You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an "AS IS" BASIS,\n#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#  See the License for the specific language governing permissions and\n#  limitations under the License.\n\n\n# 所属集群名字\nbrokerClusterName=DefaultCluster\n\n# broker 名字，注意此处不同的配置文件填写的不一样，如果在 broker-a.properties 使用: broker-a,\n# 在 broker-b.properties 使用: broker-b\nbrokerName=broker-a\n\n# 0 表示 Master，> 0 表示 Slave\nbrokerId=0\n\n# nameServer地址，分号分割\n# namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876\n\n# 启动IP,如果 docker 报 com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to <192.168.0.120:10909> failed\n# 解决方式1 加上一句 producer.setVipChannelEnabled(false);，解决方式2 brokerIP1 设置宿主机IP，不要使用docker 内部IP\n# brokerIP1=192.168.0.253\n\n# 在发送消息时，自动创建服务器不存在的topic，默认创建的队列数\ndefaultTopicQueueNums=4\n\n# 是否允许 Broker 自动创建 Topic，建议线下开启，线上关闭 ！！！这里仔细看是 false，false，false\nautoCreateTopicEnable=true\n\n# 是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭\nautoCreateSubscriptionGroup=true\n\n# Broker 对外服务的监听端口\nlistenPort=10911\n\n# 删除文件时间点，默认凌晨4点\ndeleteWhen=04\n\n# 文件保留时间，默认48小时\nfileReservedTime=120\n\n# commitLog 每个文件的大小默认1G\nmapedFileSizeCommitLog=1073741824\n\n# ConsumeQueue 每个文件默认存 30W 条，根据业务情况调整\nmapedFileSizeConsumeQueue=300000\n\n# destroyMapedFileIntervalForcibly=120000\n# redeleteHangedFileInterval=120000\n# 检测物理文件磁盘空间\ndiskMaxUsedSpaceRatio=88\n# 存储路径\n# storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store\n# commitLog 存储路径\n# storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog\n# 消费队列存储\n# storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue\n# 消息索引存储路径\n# storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index\n# checkpoint 文件存储路径\n# storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint\n# abort 文件存储路径\n# abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort\n# 限制的消息大小\nmaxMessageSize=65536\n\n# flushCommitLogLeastPages=4\n# flushConsumeQueueLeastPages=2\n# flushCommitLogThoroughInterval=10000\n# flushConsumeQueueThoroughInterval=60000\n\n# Broker 的角色\n# - ASYNC_MASTER 异步复制Master\n# - SYNC_MASTER 同步双写Master\n# - SLAVE\nbrokerRole=ASYNC_MASTER\n\n# 刷盘方式\n# - ASYNC_FLUSH 异步刷盘\n# - SYNC_FLUSH 同步刷盘\nflushDiskType=ASYNC_FLUSH\n\n# 发消息线程池数量\n# sendMessageThreadPoolNums=128\n# 拉消息线程池数量\n# pullMessageThreadPoolNums=128\n')])])]),n("h2",{attrs:{id:"rocketmq-控制台"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-控制台"}},[t._v("#")]),t._v(" RocketMQ 控制台")]),t._v(" "),n("p",[t._v("访问 http://rmqIP:8080 登入控制台")]),t._v(" "),n("p",[n("img",{attrs:{src:"/micro/Lusifer_20190115014325.png",alt:""}})])])}),[],!1,null,null,null);e.default=a.exports}}]);